<div class="chatbot-container">
    <!-- Header Bar -->
    <div class="chat-header">
        <div class="header-content">
            <div class="header-left">
                <div class="header-text">
                    <h1>ch8t-GPT</h1>
                </div>
                <div class="model-selector" (click)="onModelSelectorClick($event)">
                    <button class="model-button" (click)="toggleModelPopup()">
                        <span class="model-dot"></span>
                        <span class="model-name">{{ getModelDisplayName(selectedModel) }}</span>
                        <svg
                            class="dropdown-arrow"
                            width="12"
                            height="12"
                            viewBox="0 0 24 24"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M6 9L12 15L18 9"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            />
                        </svg>
                    </button>
                    <!-- Overlay for closing popup when clicking outside -->
                    @if(showModelPopup) {
                    <div class="model-popup-overlay" (click)="closeModelPopup()"></div>
                    }
                    <div
                        class="model-popup"
                        [class.active]="showModelPopup"
                        (click)="$event.stopPropagation()"
                    >
                        <div class="popup-header">
                            <span>Select Model</span>
                            <button class="close-popup" (click)="closeModelPopup()">
                                <svg
                                    width="16"
                                    height="16"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                        d="M18 6L6 18"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                    />
                                    <path
                                        d="M6 6L18 18"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                    />
                                </svg>
                            </button>
                        </div>
                        <div class="popup-options">
                            <button
                                class="model-option"
                                [class.selected]="selectedModel === '8GPT-mini'"
                                (click)="selectModel('8GPT-mini')"
                            >
                                <span class="option-dot"></span>
                                <span class="option-name">8GPT-mini</span>
                                <span class="option-desc">Fast & Lightweight</span>
                            </button>
                            <button
                                class="model-option"
                                [class.selected]="selectedModel === '8GPT'"
                                (click)="selectModel('8GPT')"
                            >
                                <span class="option-dot"></span>
                                <span class="option-name">8GPT</span>
                                <span class="option-desc">Balanced Performance</span>
                            </button>
                            <button
                                class="model-option"
                                [class.selected]="selectedModel === '8GPT-o'"
                                (click)="selectModel('8GPT-o')"
                            >
                                <span class="option-dot"></span>
                                <span class="option-name">8GPT-o</span>
                                <span class="option-desc">Enhanced Reasoning</span>
                            </button>
                            <button
                                class="model-option"
                                [class.selected]="selectedModel === '8GPT-ultra'"
                                (click)="selectModel('8GPT-ultra')"
                            >
                                <span class="option-dot"></span>
                                <span class="option-name">8GPT-ultra</span>
                                <span class="option-desc">Maximum Power</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <button class="info-button" (click)="openInfoModal()">
                <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                    <path
                        d="M12 16v-4"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                    />
                    <path
                        d="M12 8h.01"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                    />
                </svg>
            </button>
        </div>
    </div>

    <div class="chat-messages">
        <!-- Welcome Message (No Message) -->
        @if(messages.length === 0) {
        <div class="welcome-message">
            <div class="welcome-content">
                <div class="welcome-icon">
                    <img src="8_ball_logo.png" />
                </div>
                <h2>Welcome to ch8t-GPT</h2>
                <p>
                    Ask me any question and I'll reveal what the mystical forces have to say about
                    your future...
                </p>
                <div class="example-questions">
                    <p><strong>Try asking:</strong></p>
                    <ul>
                        <li>"Will I get the job?"</li>
                        <li>"Should I take that trip?"</li>
                        <li>"Is today a good day?"</li>
                    </ul>
                </div>
            </div>
        </div>
        } @else {
        <!-- Messages Container -->
        @for(message of messages; track $index) {
        <div
            class="message"
            [ngClass]="{
                'user-message': message.isUser,
                'bot-message': !message.isUser
            }"
        >
            <div class="message-content">
                @if(!message.isUser) {
                <div class="message-avatar">
                    <div class="magic-8-ball-small">8</div>
                </div>
                }
                <div class="message-bubble">
                    <p>{{ message.text }}</p>
                    <span class="message-time">{{ message.timestamp | date : 'shortTime' }}</span>
                </div>
            </div>
        </div>
        } }
        <!-- Loading Container -->
        @if(isLoading) {
        <div class="loading-message">
            <div class="message-content">
                <div class="message-avatar">
                    <div class="magic-8-ball-small">8</div>
                </div>
                <div class="message-bubble loading">
                    <div class="typing-indicator">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                </div>
            </div>
        </div>
        }
    </div>

    <!-- Chat Input Field -->
    <div class="chat-input">
        <div class="input-container">
            <textarea
                [(ngModel)]="newMessage"
                (keypress)="onKeyPress($event)"
                placeholder="Ask ch8t-GPT anything..."
                rows="1"
                #messageInput
                (input)="autoResize(messageInput)"
            ></textarea>
            <button
                (click)="sendMessage()"
                [disabled]="!newMessage.trim() || isLoading"
                class="send-button"
            >
                <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M22 2L11 13"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M22 2L15 22L11 13L2 9L22 2Z"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                </svg>
            </button>
        </div>
    </div>
</div>

<!-- Info Modal -->
<div class="modal-overlay" [class.active]="showInfoModal" (click)="closeInfoModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>About</h2>
            <button class="close-button" (click)="closeInfoModal()">
                <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M18 6L6 18"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                    <path
                        d="M6 6L18 18"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    />
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="info-section">
                <h3>What is ch8t-GPT?</h3>
                <p>The world's most powerfull LLM chat bot powered by divination</p>
                <!-- <p>
                    ch8t-GPT is a mystical AI chatbot inspired by the classic Magic 8-Ball. Ask it
                    any question and receive mysterious, fortune-telling responses that will guide
                    you through life's uncertainties.
                </p> -->
            </div>

            <!-- <div class="info-section">
                <h3>✨ How to Use</h3>
                <ul>
                    <li>Type your question in the chat input below</li>
                    <li>Press Enter or click the send button</li>
                    <li>Wait for the mystical response from the Magic 8-Ball</li>
                    <li>Ask follow-up questions to dive deeper into your future</li>
                </ul>
            </div>

            <div class="info-section">
                <h3>🔮 Example Questions</h3>
                <ul>
                    <li>"Will I get the job I applied for?"</li>
                    <li>"Should I take that trip next month?"</li>
                    <li>"Is today a good day to make important decisions?"</li>
                    <li>"What does my future hold in love?"</li>
                    <li>"Should I trust my instincts about this situation?"</li>
                </ul>
            </div>

            <div class="info-section">
                <h3>🌟 Features</h3>
                <ul>
                    <li>Mystical AI responses with a touch of magic</li>
                    <li>Beautiful, responsive design</li>
                    <li>Real-time chat interface</li>
                    <li>Mobile-friendly experience</li>
                    <li>Animated loading indicators</li>
                </ul>
            </div>

            <div class="info-section">
                <h3>⚡ Tips</h3>
                <p>
                    For the best experience, ask specific questions and be open to the mystical
                    guidance. Remember, the Magic 8-Ball speaks in mysterious ways - sometimes the
                    answers are clearer than they first appear!
                </p>
            </div> -->
        </div>
    </div>
</div>
